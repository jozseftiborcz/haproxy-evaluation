{"version": 2, "width": 208, "height": 75, "timestamp": 1659080238, "env": {"SHELL": "/bin/bash", "TERM": "xterm-256color"}}
[0.163566, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[1.065793, "o", "docker-compose "]
[2.065793, "o", "--profile "]
[3.065793, "o", "jwt-limit "]
[4.065793, "o", "up"]
[4.515925, "o", "\r\n"]
[5.467662, "o", "Starting haproxy-evaluation_api01_1 ... \r\r\n"]
[5.468374, "o", "Starting haproxy-evaluation_api02_1 ... \r\r\n"]
[5.468967, "o", "Starting haproxy-evaluation_loadbalancer-jwt-limit_1 ... \r\r\n"]
[5.827732, "o", "\u001b[2A\u001b[2K\rStarting haproxy-evaluation_api02_1                  ... \u001b[32mdone\u001b[0m\r\u001b[2B"]
[6.004114, "o", "\u001b[1A\u001b[2K\rStarting haproxy-evaluation_loadbalancer-jwt-limit_1 ... \u001b[32mdone\u001b[0m\r\u001b[1B"]
[7.004114, "o", "\u001b[3A\u001b[2K\rStarting haproxy-evaluation_api01_1                  ... \u001b[32mdone\u001b[0m\r\u001b[3B"]
[7.004333, "o", "Attaching to haproxy-evaluation_api02_1, haproxy-evaluation_loadbalancer-jwt-limit_1, haproxy-evaluation_api01_1\r\n"]
[7.006206, "o", "\u001b[33mapi02_1                   |\u001b[0m Listening on :8000\r\n"]
[7.006336, "o", "\u001b[32mloadbalancer-jwt-limit_1  |\u001b[0m Reading file /etc/haproxy/pem/pubkey.pem\r\n"]
[7.006452, "o", "\u001b[32mloadbalancer-jwt-limit_1  |\u001b[0m PublicKeyPath: /etc/haproxy/pem/pubkey.pem\r\n"]
[7.006687, "o", "\u001b[32mloadbalancer-jwt-limit_1  |\u001b[0m Issuer: https://auth.example.com\r\n"]
[7.007079999999999, "o", "\u001b[32mloadbalancer-jwt-limit_1  |\u001b[0m Audience: https://mobile-client.example.com\r\n"]
[7.0071330000000005, "o", "\u001b[36mapi01_1                   |\u001b[0m Listening on :8000\r\n\u001b[32mloadbalancer-jwt-limit_1  |\u001b[0m [NOTICE]   (1) : New worker (8) forked\r\n\u001b[32mloadbalancer-jwt-limit_1  |\u001b[0m [NOTICE]   (1) : Loading success.\r\n"]
[8.007133, "o", "^Z"]
[8.007375, "o", "\r\n"]
[8.007502, "o", "[1]+  Stopped                 docker-compose --profile jwt-limit up\r\n"]
[8.0077, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[9.0077, "o", "curl "]
[10.0077, "o", "http://localhost"]
[11.0077, "o", "\r\n"]
[11.024065, "o", "I'm a5195411f9fe\r\n"]
[11.024881999999998, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[11.847745, "o", "curl http://localhost"]
[12.170655, "o", "\r\n"]
[12.187691999999998, "o", "I'm 477c41cbba36\r\n"]
[12.190088, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[12.510897999999997, "o", "curl http://localhost"]
[12.859044999999998, "o", "\r\n"]
[12.874782, "o", "I'm a5195411f9fe\r\n"]
[12.876190999999999, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[13.229492999999998, "o", "curl http://localhost"]
[13.569959999999998, "o", "\r\n"]
[13.575322999999997, "o", "I'm 477c41cbba36\r\n"]
[13.576117999999997, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[13.978697999999998, "o", "curl http://localhost"]
[14.314453, "o", "\r\n"]
[14.329791999999998, "o", "I'm a5195411f9fe\r\n"]
[14.331945999999999, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[14.666218999999998, "o", "curl http://localhost"]
[14.959288999999998, "o", "\r\n"]
[14.965366, "o", "I'm 477c41cbba36\r\n"]
[14.966159999999999, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[15.258312999999998, "o", "curl http://localhost"]
[15.576283999999998, "o", "\r\n"]
[15.600787999999998, "o", "I'm a5195411f9fe\r\n"]
[15.603105, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[16.603105, "o", "# no limit here!"]
[17.603105, "o", "\r\n"]
[17.603421000000004, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[18.603421000000004, "o", "# now generating some tokens..."]
[19.603421000000004, "o", "\r\n"]
[19.603550000000006, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[20.603550000000006, "o", "./scripts/gen-token.sh "]
[21.603550000000006, "o", "\r\n"]
[21.616844, "o", "usage:  (valid|expired|wrongaud|wrongiss)\r\n"]
[21.617063, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[22.617063, "o", "./scripts/gen-token.sh valid"]
[23.617063, "o", "\r\n"]
[24.617063, "o", "eyJhbGciOiAiUlMyNTYiLCAidHlwIjogIkpXVCJ9.eyJleHAiOiAiMTY1OTA4MDYxMiIsICJpc3MiOiAiaHR0cHM6Ly9hdXRoLmV4YW1wbGUuY29tIiwgImF1ZCI6ICJodHRwczovL21vYmlsZS1jbGllbnQuZXhhbXBsZS5jb20iLCAic3ViIjoiN2ViYTIwMTktM2JjMC00NzdkLWI3MzMtMmVlZjhlNjc1NTYxIn0.BR3hxv_rcwmN8U5ijkNyVLxn2HKQka4mSwtU_x12y7BpJvctizjfqp5MmZJN5xRZns40nZKTOyjSVmLoApMWQTVHk6a8dUKPiLvLzzLp4rvakwQJGlw07AxVa4IzOpLSItk-ahJAvE91uKrdQQGKL3p5FL6na61V-X7FLxxC1lCoFlHJLKb45eq-zp9Xr2tPhjJnxO87OTCzp42GXT4reV9VnMaOemDiAzTWHBekST_bSHDcCQVGlTIm8TuGhXgtn8ru4jNji9Mr8clwe2HFVOFBeBim8WxK7TdpkTHX-U2eeOuU6RjMRzioSA0KxB-CfeuZFEUuDaKb0Sf2NtFHmg\r\n"]
[24.617255, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[25.617255, "o", "./scripts/gen-token.sh valid > valid.token"]
[26.617255, "o", "\r\n"]
[26.664869999999993, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[27.122783999999996, "o", "./scripts/gen-token.sh expired > expired.token"]
[28.122783999999996, "o", "\r\n"]
[28.122967000000003, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[29.122967000000003, "o", "curl "]
[30.122967000000003, "o", "http://localhost/api"]
[31.122967000000003, "o", "\r\n"]
[31.129211999999995, "o", "<html><body><h1>403 Forbidden</h1>\r\nRequest forbidden by administrative rules.\r\n</body></html>\r\n"]
[31.130070000000003, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[32.13007, "o", "# /api endpoint is protected by jwt..."]
[33.13007, "o", "\r\n"]
[33.130157, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[34.130157, "o", "curl -H \"Authorization: Bearer $(cat valid.token)\" http://localhost/api"]
[35.130157, "o", "\r\n"]
[35.137866, "o", "I'm aee6cf193786\r\n"]
[35.138795999999985, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[36.138795999999985, "o", "# it works with a valid token"]
[37.138795999999985, "o", "\r\n"]
[37.139013999999975, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[38.139013999999975, "o", "# test with expired token..."]
[39.139013999999975, "o", "\r\n"]
[39.13914799999998, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[40.13914799999998, "o", "curl -H \"Authorization: Bearer $(cat expired.token)\" http://localhost/api"]
[40.59595399999998, "o", "\r\n"]
[40.603185999999965, "o", "<html><body><h1>403 Forbidden</h1>\r\nRequest forbidden by administrative rules.\r\n</body></html>\r\n"]
[40.60411499999998, "o", "\u001b]0;computer: ~/haproxy-evaluation\u0007\u001b[01;32mcomputer\u001b[00m:\u001b[01;34m~/haproxy-evaluation\u001b[00m$ "]
[44.300056, "o", "# THANKS "]
[44.380082, "o", "\r\n"]
